<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
        />
        <title>Dice</title>

        <!-- PWA Meta Tags -->
        <link rel="manifest" href="/manifest.json" />
        <link rel="icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/svg+xml" href="/icon.svg" />
        <meta
            name="theme-color"
            content="#ffffff"
            media="(prefers-color-scheme: light)"
        />
        <meta
            name="theme-color"
            content="#000000"
            media="(prefers-color-scheme: dark)"
        />
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style" content="default" />
        <meta name="apple-mobile-web-app-title" content="Dice" />
        <link rel="apple-touch-icon" href="/icon-192.png" />

        <style>
            body {
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                height: 100dvh;
                margin: 0;
                gap: 1rem;
                touch-action: manipulation;
                background-color: white;
                color: black;
            }

            @media (prefers-color-scheme: dark) {
                body {
                    background-color: black;
                    color: white;
                }
            }
            #dice {
                flex: 3;
                display: grid;
                align-items: center;
                justify-content: center;
                align-content: center;
                font-size: min(30vh, 30vw);
                gap: 1vh;
                width: 100%;
            }
            #actions {
                flex: 1;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 2vh;
            }
            button {
                padding: 2vh 4vh;
                font-size: min(10vh, 8vw);
                cursor: pointer;
                touch-action: manipulation;
            }
            #minus-button,
            #plus-button {
                width: min(15vh, 20vw);
            }
        </style>
    </head>
    <body>
        <div id="dice">?</div>
        <div id="actions">
            <button id="minus-button">-</button>
            <button id="roll-button">Roll</button>
            <button id="plus-button">+</button>
        </div>
    </body>
    <script>
        const FACES = ["⚀", "⚁", "⚂", "⚃", "⚄", "⚅"];
        const dice = document.getElementById("dice");
        const rollButton = document.getElementById("roll-button");
        const minusButton = document.getElementById("minus-button");
        const plusButton = document.getElementById("plus-button");

        let diceCount = 1;

        function updateDice() {
            // Calculate grid dimensions (prefer even distribution)
            const cols = Math.ceil(Math.sqrt(diceCount));
            const rows = Math.ceil(diceCount / cols);

            dice.style.gridTemplateColumns = `repeat(${cols}, auto)`;
            dice.style.gridTemplateRows = `repeat(${rows}, auto)`;

            const results = [];
            for (let i = 0; i < diceCount; i++) {
                const randomNumber = Math.floor(Math.random() * FACES.length);
                results.push(`<span>${FACES[randomNumber]}</span>`);
            }
            dice.innerHTML = results.join("");
        }

        function updateButtons() {
            minusButton.disabled = diceCount <= 1;
            plusButton.disabled = diceCount >= 6;
        }

        rollButton.addEventListener("click", () => {
            updateDice();
        });

        minusButton.addEventListener("click", () => {
            if (diceCount > 1) {
                diceCount--;
                updateDice();
                updateButtons();
            }
        });

        plusButton.addEventListener("click", () => {
            if (diceCount < 6) {
                diceCount++;
                updateDice();
                updateButtons();
            }
        });

        updateButtons();
        updateDice();

        // Register Service Worker for PWA
        if ("serviceWorker" in navigator) {
            window.addEventListener("load", () => {
                navigator.serviceWorker
                    .register("/sw.js")
                    .then((registration) => {
                        console.log("Service Worker registered:", registration);
                    })
                    .catch((error) => {
                        console.log(
                            "Service Worker registration failed:",
                            error,
                        );
                    });
            });
        }
    </script>
</html>
